<%= box_widget "Person information" do %>
	<%= form.inputs do %>
		<li id="referral_person_full_name_input" class="string input required stringish">
			<%= label_tag :referral_person_full_name, 'Person<abbr title="required">*</abbr>'.html_safe, :class => "label" %>
			<%= form.autocomplete_field :person_full_name, autocomplete_person_full_name_referrals_path, :id_element => '#referral_person_id', :size => "51" %>
			<%= form.semantic_errors :person_id %>
			<%= hidden_field :referral, :person_id %>
			<a href="javascript:void(0)" id="show-all-people" class="icon list" original-title="Show all people" title="Show all people">Show all people</a>
			<%= render 'shared/person_information', :person => @referral.person %>
			<p class="inline-hints">Begin typing to get suggestions</p>
		</li>
		<% #= form.autocompleted_input :patient_full_name, :url => autocomplete_patient_full_name_referrals_path %>
		<%= form.input :patient_status, :collection => @patient_statuses.map {|u| [u.status, u.id]} %>
		<li class="input">
			<%= form.label :patient_consent, :class => "label" %>
			<%= form.check_box :patient_consent %>
		</li>
		<% #= form.input :patient_consent, :as => :boolean %>
	<% end %>
<% end %>

<%= box_widget "Case information" do %>
	<%= form.inputs do %>
		<%= form.input :case_nature, :as => :text, :hint => "Describe what is wrong with the patient" %>
		<%= form.input :specific_requirements, :as => :text, :hint => "Does the patient require disabled access or morning appointments? Only speaks Spanish? Anything else similar" %>
		<%= form.input :advice, :as => :text, :hint => "Advice already given to the patient which may be relevant" %>
	<% end %>
<% end %>

<%= box_widget "Attachments" do %>
	<%= form.inputs :class => "nested-attributes" do %>
		<li class="string input">
			<%= label_tag :referral_person_full_name, 'Attached files'.html_safe, :class => "label" %>
			<div class="file-list">
			<%= form.semantic_fields_for :documents do |doc| %>
				<% if !doc.object.new_record? %>
					<%= render 'shared/document_fields', :f => doc %>
				<% end %>
			<% end %>
			</div>
		</li>
		<li class="string input">
			<%= label_tag :referral_person_full_name, 'Upload files'.html_safe, :class => "label" %>
			<div id="upload-file-list" class="file-list">
			<%= form.semantic_fields_for :documents do |doc| %>
				<% if doc.object.new_record? %>
					<%= render 'shared/document_fields', :f => doc %>
				<% end %>
			<% end %>
			</div>
			<div class="button">
				<%= button_to_add_fields "Add document", form, :documents, {:class => "btn small grey", :id => "referral-file-to-upload"}, "upload-file-list" %>
			</div>
		</li>
	<% end %>
<% end %>

<%= box_widget "Submit referral" do %>
	<%= form.inputs do %>
		<%= form.input :referral_reason, :collection => @referral_reasons.map {|u| [u.reason, u.id]} %>
		<%= form.input :preferred_date, :as => :datepicker %>
		<%= form.input :followers, :input_html => {:id => "cmx-token-input", :class => "clean", :suggestions_url => followers_suggestions_referrals_path}, :include_blank => true %>
	<% end %>
	<%= form.buttons do %>
		<%= form.commit_button :button_html => {:class => "btn large orange auto"} %>
	<% end %>
<% end%>