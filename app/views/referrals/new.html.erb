<% title "Add referral" %>

<%= semantic_form_for @referral, :url => referrals_path, :html => {:id => "new_referral", :multipart => true} do |form| %>

<%= box_widget "Person information" do %>
	<%= form.inputs do %>
		<li id="referral_person_full_name_input" class="string input required stringish">
			<%= label_tag :referral_person_full_name, 'Person<abbr title="required">*</abbr>'.html_safe, :class => "label" %>
			<%= form.autocomplete_field :person_full_name, autocomplete_person_full_name_referrals_path, :id_element => '#referral_person_id', :size => "51" %>
			<%= form.semantic_errors :person_id %>
			<%= hidden_field :referral, :person_id %>
			<p class="inline-hints">Begin typing to get suggestions</p>
		</li>
		<% #= form.autocompleted_input :patient_full_name, :url => autocomplete_patient_full_name_referrals_path %>
		<%= form.input :patient_status, :collection => @patient_statuses.map {|u| [u.status, u.id]} %>
		<%= form.input :patient_consent, :as => :boolean %>
	<% end %>
<% end %>

<%= box_widget "Case information" do %>
	<%= form.inputs do %>
		<%= form.input :case_nature, :as => :text %>
		<%= form.input :specific_requirements, :as => :text %>
		<%= form.input :advice, :as => :text %>
	<% end %>
<% end %>

<%= box_widget "Attachments" do %>
	<%= form.inputs :class => "nested-attributes" do %>
		<li id="referral_person_full_name_input" class="string input required stringish">
			<%= label_tag :referral_person_full_name, 'Add files'.html_safe, :class => "label" %>
			<%= form.semantic_fields_for :documents, :html => {:class => "nested-attributes"} do |doc| %>
				<% if doc.object.new_record? %>
					<%= doc.inputs do %>
						<%= doc.input :document, :as => :file %>
						<%= doc.input :title %>
						<%= doc.input :description, :as => :text %>
					<% end %>
				<% end %>
			<% end %>
		</li>
		<li class="button">
			<a class="btn small grey" href="#"><span>Add another file</span></a>
		</li>
	<% end %>
<% end %>

<%= box_widget "Submit referral" do %>
	<%= form.inputs do %>
			<%= form.input :referral_reason, :collection => @referral_reasons.map {|u| [u.reason, u.id]} %>
			<%= form.input :preferred_date, :as => :datepicker %>
		<% end %>
		<%= form.buttons do %>
			<%= form.commit_button :button_html => {:class => "btn large orange auto"} %>
		<% end %>
<% end%>

<% end %>